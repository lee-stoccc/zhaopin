{"version":3,"sources":["wxParse/html2json.js"],"names":["__placeImgeUrlHttps","__emojisReg","__emojisBaseSrc","__emojis","wxDiscode","require","HTMLParser","empty","makeMap","block","inline","closeSelf","fillAttrs","special","str","obj","items","split","i","length","q","v","removeDOCTYPE","html","replace","trimHtml","html2json","bindName","strDiscode","bufArray","results","node","nodes","images","imageUrls","index","start","tag","attrs","unary","toString","parent","undefined","tagType","attr","reduce","pre","name","value","console","dir","classStr","styleStr","match","Array","isArray","push","imgIndex","imgUrl","src","splice","urlToHttpUrl","from","fontSize","styleAttrs","style","key","source","unshift","end","shift","error","chars","text","textArray","transEmojiStr","comment","emojiObjs","emojiObj","array","eReg","RegExp","ele","baseSrc","emojisInit","reg","emojis","module","exports"],"mappings":"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","file":"html2json.js","sourcesContent":["/**\n * html2Json 改造来自: https://github.com/Jxck/html2json\n * \n * \n * author: Di (微信小程序开发工程师)\n * organization: WeAppDev(微信小程序开发论坛)(http://weappdev.com)\n *               垂直微信小程序开发交流社区\n * \n * github地址: https://github.com/icindy/wxParse\n * \n * for: 微信小程序富文本解析\n * detail : http://weappdev.com/t/wxparse-alpha0-1-html-markdown/184\n */\n\nvar __placeImgeUrlHttps = \"https\";\nvar __emojisReg = '';\nvar __emojisBaseSrc = '';\nvar __emojis = {};\nvar wxDiscode = require('./wxDiscode.js');\nvar HTMLParser = require('./htmlparser.js');\n// Empty Elements - HTML 5\nvar empty = makeMap(\"area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr\");\n// Block Elements - HTML 5\nvar block = makeMap(\"br,a,code,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video\");\n\n// Inline Elements - HTML 5\nvar inline = makeMap(\"abbr,acronym,applet,b,basefont,bdo,big,button,cite,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var\");\n\n// Elements that you can, intentionally, leave open\n// (and which close themselves)\nvar closeSelf = makeMap(\"colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr\");\n\n// Attributes that have their values filled in disabled=\"disabled\"\nvar fillAttrs = makeMap(\"checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected\");\n\n// Special Elements (can contain anything)\nvar special = makeMap(\"wxxxcode-style,script,style,view,scroll-view,block\");\nfunction makeMap(str) {\n    var obj = {}, items = str.split(\",\");\n    for (var i = 0; i < items.length; i++)\n        obj[items[i]] = true;\n    return obj;\n}\n\nfunction q(v) {\n    return '\"' + v + '\"';\n}\n\nfunction removeDOCTYPE(html) {\n    return html\n        .replace(/<\\?xml.*\\?>\\n/, '')\n        .replace(/<.*!doctype.*\\>\\n/, '')\n        .replace(/<.*!DOCTYPE.*\\>\\n/, '');\n}\n\nfunction trimHtml(html) {\n  return html\n        .replace(/\\r?\\n+/g, '')\n        .replace(/<!--.*?-->/ig, '')\n        .replace(/\\/\\*.*?\\*\\//ig, '')\n        .replace(/[ ]+</ig, '<')\n}\n\n\nfunction html2json(html, bindName) {\n    //处理字符串\n    html = removeDOCTYPE(html);\n    html = trimHtml(html);\n    html = wxDiscode.strDiscode(html);\n    //生成node节点\n    var bufArray = [];\n    var results = {\n        node: bindName,\n        nodes: [],\n        images:[],\n        imageUrls:[]\n    };\n    var index = 0;\n    HTMLParser(html, {\n        start: function (tag, attrs, unary) {\n            //debug(tag, attrs, unary);\n            // node for this element\n            var node = {\n                node: 'element',\n                tag: tag,\n            };\n\n            if (bufArray.length === 0) {\n                node.index = index.toString()\n                index += 1\n            } else {\n                var parent = bufArray[0];\n                if (parent.nodes === undefined) {\n                    parent.nodes = [];\n                }\n                node.index = parent.index + '.' + parent.nodes.length\n            }\n\n            if (block[tag]) {\n                node.tagType = \"block\";\n            } else if (inline[tag]) {\n                node.tagType = \"inline\";\n            } else if (closeSelf[tag]) {\n                node.tagType = \"closeSelf\";\n            }\n\n            if (attrs.length !== 0) {\n                node.attr = attrs.reduce(function (pre, attr) {\n                    var name = attr.name;\n                    var value = attr.value;\n                    if (name == 'class') {\n                        console.dir(value);\n                        //  value = value.join(\"\")\n                        node.classStr = value;\n                    }\n                    // has multi attibutes\n                    // make it array of attribute\n                    if (name == 'style') {\n                        console.dir(value);\n                        //  value = value.join(\"\")\n                        node.styleStr = value;\n                    }\n                    if (value.match(/ /)) {\n                        value = value.split(' ');\n                    }\n                    \n\n                    // if attr already exists\n                    // merge it\n                    if (pre[name]) {\n                        if (Array.isArray(pre[name])) {\n                            // already array, push to last\n                            pre[name].push(value);\n                        } else {\n                            // single value, make it array\n                            pre[name] = [pre[name], value];\n                        }\n                    } else {\n                        // not exist, put it\n                        pre[name] = value;\n                    }\n\n                    return pre;\n                }, {});\n            }\n\n            //对img添加额外数据\n            if (node.tag === 'img') {\n                node.imgIndex = results.images.length;\n                var imgUrl = node.attr.src;\n                if (imgUrl[0] == '') {\n                    imgUrl.splice(0, 1);\n                }\n                imgUrl = wxDiscode.urlToHttpUrl(imgUrl, __placeImgeUrlHttps);\n                node.attr.src = imgUrl;\n                node.from = bindName;\n                results.images.push(node);\n                results.imageUrls.push(imgUrl);\n            }\n            \n            // 处理font标签样式属性\n            if (node.tag === 'font') {\n                var fontSize = ['x-small', 'small', 'medium', 'large', 'x-large', 'xx-large', '-webkit-xxx-large'];\n                var styleAttrs = {\n                    'color': 'color',\n                    'face': 'font-family',\n                    'size': 'font-size'\n                };\n                if (!node.attr.style) node.attr.style = [];\n                if (!node.styleStr) node.styleStr = '';\n                for (var key in styleAttrs) {\n                    if (node.attr[key]) {\n                        var value = key === 'size' ? fontSize[node.attr[key]-1] : node.attr[key];\n                        node.attr.style.push(styleAttrs[key]);\n                        node.attr.style.push(value);\n                        node.styleStr += styleAttrs[key] + ': ' + value + ';';\n                    }\n                }\n            }\n\n            //临时记录source资源\n            if(node.tag === 'source'){\n                results.source = node.attr.src;\n            }\n            \n            if (unary) {\n                // if this tag dosen't have end tag\n                // like <img src=\"hoge.png\"/>\n                // add to parents\n                var parent = bufArray[0] || results;\n                if (parent.nodes === undefined) {\n                    parent.nodes = [];\n                }\n                parent.nodes.push(node);\n            } else {\n                bufArray.unshift(node);\n            }\n        },\n        end: function (tag) {\n            //debug(tag);\n            // merge into parent tag\n            var node = bufArray.shift();\n            if (node.tag !== tag) console.error('invalid state: mismatch end tag');\n\n            //当有缓存source资源时于于video补上src资源\n            if(node.tag === 'video' && results.source){\n                node.attr.src = results.source;\n                delete results.source;\n            }\n            \n            if (bufArray.length === 0) {\n                results.nodes.push(node);\n            } else {\n                var parent = bufArray[0];\n                if (parent.nodes === undefined) {\n                    parent.nodes = [];\n                }\n                parent.nodes.push(node);\n            }\n        },\n        chars: function (text) {\n            //debug(text);\n            var node = {\n                node: 'text',\n                text: text,\n                textArray:transEmojiStr(text)\n            };\n            \n            if (bufArray.length === 0) {\n                node.index = index.toString()\n                index += 1\n                results.nodes.push(node);\n            } else {\n                var parent = bufArray[0];\n                if (parent.nodes === undefined) {\n                    parent.nodes = [];\n                }\n                node.index = parent.index + '.' + parent.nodes.length\n                parent.nodes.push(node);\n            }\n        },\n        comment: function (text) {\n            //debug(text);\n            // var node = {\n            //     node: 'comment',\n            //     text: text,\n            // };\n            // var parent = bufArray[0];\n            // if (parent.nodes === undefined) {\n            //     parent.nodes = [];\n            // }\n            // parent.nodes.push(node);\n        },\n    });\n    return results;\n};\n\nfunction transEmojiStr(str){\n  // var eReg = new RegExp(\"[\"+__reg+' '+\"]\");\n//   str = str.replace(/\\[([^\\[\\]]+)\\]/g,':$1:')\n  \n  var emojiObjs = [];\n  //如果正则表达式为空\n  if(__emojisReg.length == 0 || !__emojis){\n      var emojiObj = {}\n      emojiObj.node = \"text\";\n      emojiObj.text = str;\n      array = [emojiObj];\n      return array;\n  }\n  //这个地方需要调整\n  str = str.replace(/\\[([^\\[\\]]+)\\]/g,':$1:')\n  var eReg = new RegExp(\"[:]\");\n  var array = str.split(eReg);\n  for(var i = 0; i < array.length; i++){\n    var ele = array[i];\n    var emojiObj = {};\n    if(__emojis[ele]){\n      emojiObj.node = \"element\";\n      emojiObj.tag = \"emoji\";\n      emojiObj.text = __emojis[ele];\n      emojiObj.baseSrc= __emojisBaseSrc;\n    }else{\n      emojiObj.node = \"text\";\n      emojiObj.text = ele;\n    }\n    emojiObjs.push(emojiObj);\n  }\n  \n  return emojiObjs;\n}\n\nfunction emojisInit(reg='',baseSrc=\"/wxParse/emojis/\",emojis){\n    __emojisReg = reg;\n    __emojisBaseSrc=baseSrc;\n    __emojis=emojis;\n}\n\nmodule.exports = {\n    html2json: html2json,\n    emojisInit:emojisInit\n};\n\n"]}